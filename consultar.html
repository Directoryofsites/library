<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultar - Lumen Logos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .search-container {
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .search-input {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--primary-color);
            border-right: none;
            border-radius: 5px 0 0 5px;
            font-size: 16px;
        }
        
        .search-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }
        
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .filter-box {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-width: 200px;
        }
        
        .filter-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .filter-options {
            max-height: 150px;
            overflow-y: auto;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .filter-option input {
            margin-right: 8px;
        }
        
        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .document-card {
            border: 1px solid #eee;
            border-radius: 5px;
            overflow: hidden;
            transition: all 0.3s ease;
            background-color: white;
        }
        
        .document-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }
        
        .document-card-content {
            padding: 20px;
        }
        
        .document-title {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .document-description {
            color: var(--tertiary-color);
            margin-bottom: 15px;
        }
        
        .document-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .document-tag {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .document-view-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .document-view-btn:hover {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }
        
               
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 50px;
        }
        
        .pagination-btn {
            padding: 8px 15px;
            margin: 0 5px;
            border: 1px solid var(--primary-color);
            background-color: white;
            color: var(--primary-color);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination-btn:hover, .pagination-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .no-results {
            text-align: center;
            padding: 50px;
            color: var(--tertiary-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="main-header">
                <div class="logo">
                    <img src="images/logo1.png" alt="Lumen Logos">
                    <div class="logo-text">
                        <h1>Lumen Logos</h1>
                        <p>La Luz del Verbo</p>
                    </div>
                </div>
                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <nav>
                    <ul>
                        <li><a href="index.html">Principal</a></li>
                        <li><a href="about.html">Acera de</a>
                            <ul>
                                <li><a href="mission.html">Nuestra Misión</a></li>
                                <li><a href="history.html">Historia</a></li>
                                <li><a href="statement-of-faith.html">Declaración de Fé</a></li>
                            </ul>
                        </li>
                        <li><a href="programs.html">CONOCIMIENTO</a>
                            <ul>
                                <li><a href="master-of-divinity.html">Estudios</a></li>
                                <li><a href="master-of-arts.html">Consultas</a></li>
                            </ul>
                        </li>
                        <li><a href="faculty.html">Enlaces</a></li>
                        <li><a href="admissions.html">Titulos</a>
                            <ul>
                                <li><a href="requirements.html">Requirements</a></li>
                                <li><a href="tuition.html">Tuition & Fees</a></li>
                                <li><a href="financial-aid.html">Financial Aid</a></li>
                                <li><a href="apply.html">Apply Now</a></li>
                            </ul>
                        </li>
                        <li><a href="resources.html">Buscar</a>
                            <ul>
                                <li><a href="library.html">Library</a></li>
                                <li><a href="blog.html">Blog</a></li>
                                <li><a href="events.html">Events</a></li>
                            </ul>
                        </li>
                        <li><a href="contact.html">Contacto</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="page-content" style="margin-top: 150px; padding: 50px 0;">
        <div class="container">
            <h2 class="text-center mb-5">Consultar Biblioteca Digital</h2>
            
            <!-- Search -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="search-input" class="search-input" placeholder="Buscar por título, descripción o contenido...">
                    <button id="search-btn" class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <!-- Filters -->
            <div class="filter-container">
                <div class="filter-box">
                    <div class="filter-title">Categorías</div>
                    <div class="filter-options" id="category-filters">
                        <!-- Categorías se cargarán dinámicamente -->
                    </div>
                </div>
                
                <div class="filter-box">
                    <div class="filter-title">Etiquetas populares</div>
                    <div class="filter-options" id="tag-filters">
                        <!-- Etiquetas se cargarán dinámicamente -->
                    </div>
                </div>
                
                <div class="filter-box">
                    <div class="filter-title">Tipo de archivo</div>
                    <div class="filter-options" id="file-type-filters">
                        <div class="filter-option">
                            <input type="checkbox" id="filter-text" value="text">
                            <label for="filter-text">Texto</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-pdf" value="pdf">
                            <label for="filter-pdf">PDF</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-audio" value="audio">
                            <label for="filter-audio">Audio</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-video" value="video">
                            <label for="filter-video">Video</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-image" value="image">
                            <label for="filter-image">Imagen</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Results -->
            <div class="results-container" id="results">
                <!-- Los resultados se cargarán dinámicamente -->
            </div>
            
            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <!-- La paginación se generará dinámicamente -->
            </div>
                      
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-top">
                <div class="footer-info">
                    <div class="footer-logo">
                        <img src="images/logo1.png" alt="Lumen Logos">
                    </div>
                    <div class="footer-contact">
                        <div class="footer-contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <p>123 Seminary Drive</p>
                                <p>Ciudad, CP 12345</p>
                            </div>
                        </div>
                        <div class="footer-contact-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <p>+123 456 7890</p>
                            </div>
                        </div>
                        <div class="footer-contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <p>info@lumenlogos.com</p>
                            </div>
                        </div>
                    </div>
                    <div class="footer-social">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-links">
                    <h3 class="footer-title">Links rápidos</h3>
                    <ul>
                        <li><a href="about.html">Acerca de nosotros</a></li>
                        <li><a href="programs.html">Conocimiento</a></li>
                        <li><a href="faculty.html">Enlaces</a></li>
                        <li><a href="admissions.html">Títulos</a></li>
                        <li><a href="resources.html">Buscar</a></li>
                        <li><a href="contact.html">Contacto</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h3 class="footer-title">Recursos</h3>
                    <ul>
                        <li><a href="library.html">Biblioteca</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="events.html">Eventos</a></li>
                        <li><a href="#">Recursos de estudio</a></li>
                        <li><a href="#">Centro de ayuda</a></li>
                    </ul>
                </div>
                <div class="footer-newsletter">
                    <h3 class="footer-title">Recibir novedades</h3>
                    <p>Suscríbete para recibir actualizaciones sobre nuevos recursos y eventos.</p>
                    <form>
                        <input type="email" placeholder="Tu correo electrónico" required style="width: 100%; padding: 10px; margin-bottom: 10px; border: none; border-radius: 5px;">
                        <button type="submit" class="btn btn-secondary" style="width: 100%;">Suscribirse</button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Lumen Logos. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/scripts.js"></script>
<script>
    // Inicializar cliente de Supabase
    // Reemplaza estos valores con tus credenciales de Supabase
    const SUPABASE_URL = 'https://tu-proyecto-supabase.supabase.co';
    const SUPABASE_KEY = 'tu-api-key-publica';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // Variables para la paginación
    let currentPage = 1;
    let totalDocuments = 0;
    let documentsPerPage = 9;
    let allDocuments = [];
    
    // Cargar datos al iniciar la página
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            await loadCategories();
            await loadTags();
            await loadDocuments();
        } catch (error) {
            console.error('Error al cargar datos iniciales:', error);
            loadSampleData();
        }
    });
    
    // Cargar categorías desde Supabase
    async function loadCategories() {
        try {
            const { data: categories, error } = await supabase
                .from('categories')
                .select('*')
                .order('name');
                
            if (error) throw error;
            
            const categoryFilters = document.getElementById('category-filters');
            categoryFilters.innerHTML = '';
            
            categories.forEach(category => {
                const filterOption = document.createElement('div');
                filterOption.className = 'filter-option';
                filterOption.innerHTML = `
                    <input type="checkbox" id="category-${category.id}" value="${category.id}">
                    <label for="category-${category.id}">${category.name}</label>
                `;
                categoryFilters.appendChild(filterOption);
            });
            
            // Agregar eventos a los filtros
            document.querySelectorAll('#category-filters input').forEach(input => {
                input.addEventListener('change', applyFilters);
            });
            
        } catch (error) {
            console.error('Error al cargar categorías:', error);
            throw error;
        }
    }
    
    // Cargar etiquetas desde Supabase
    async function loadTags() {
        try {
            const { data: tags, error } = await supabase
                .from('tags')
                .select('*')
                .order('name');
                
            if (error) throw error;
            
            const tagFilters = document.getElementById('tag-filters');
            tagFilters.innerHTML = '';
            
            tags.forEach(tag => {
                const filterOption = document.createElement('div');
                filterOption.className = 'filter-option';
                filterOption.innerHTML = `
                    <input type="checkbox" id="tag-${tag.id}" value="${tag.id}">
                    <label for="tag-${tag.id}">${tag.name}</label>
                `;
                tagFilters.appendChild(filterOption);
            });
            
            // Agregar eventos a los filtros
            document.querySelectorAll('#tag-filters input').forEach(input => {
                input.addEventListener('change', applyFilters);
            });
            
        } catch (error) {
            console.error('Error al cargar etiquetas:', error);
            throw error;
        }
    }
    
    // Cargar documentos desde Supabase
    async function loadDocuments() {
        try {
            // Obtener recuento total de documentos
            const { count, error: countError } = await supabase
                .from('documents')
                .select('*', { count: 'exact', head: true });
                
            if (countError) throw countError;
            
            totalDocuments = count || 0;
            
            // Obtener documentos para la página actual
            const { data: documents, error } = await supabase
                .from('documents')
                .select(`
                    *,
                    tags (*)
                `)
                .order('created_at', { ascending: false })
                .range((currentPage - 1) * documentsPerPage, currentPage * documentsPerPage - 1);
                
            if (error) throw error;
            
            // Guardar todos los documentos cargados para filtrado local
            allDocuments = documents || [];
            
            // Renderizar documentos
            renderDocuments(allDocuments);
            
            // Generar paginación
            generatePagination(totalDocuments, documentsPerPage, currentPage);
            
        } catch (error) {
            console.error('Error al cargar documentos:', error);
            throw error;
        }
    }
    
    // Cargar datos de ejemplo en caso de error con Supabase
    function loadSampleData() {
        const sampleCategories = [
            { id: 1, name: 'Libro' },
            { id: 2, name: 'Personaje' },
            { id: 3, name: 'Tema' }
        ];
        
        const sampleTags = [
            { id: 1, categoryId: 1, name: 'Salmos' },
            { id: 2, categoryId: 1, name: 'Proverbios' },
            { id: 3, categoryId: 2, name: 'David' },
            { id: 4, categoryId: 2, name: 'Salomón' },
            { id: 5, categoryId: 3, name: 'Gracia' },
            { id: 6, categoryId: 3, name: 'Fe' }
        ];
        
        const sampleDocuments = [
            {
                id: 1,
                title: 'Estudio sobre el Salmo 23',
                description: 'Un análisis profundo del Salmo del pastor divino',
                content: '<p>El Salmo 23 es quizás uno de los pasajes más conocidos y amados de toda la Escritura...</p>',
                tags: [
                    { id: 1, name: 'Salmos' },
                    { id: 5, name: 'Gracia' }
                ],
                fileType: 'text',
                fileName: null,
                fileUrl: null,
                createdAt: '2025-05-15T10:30:00'
            },
            {
                id: 2,
                title: 'La vida del rey David',
                description: 'Biografía y legado del rey según el corazón de Dios',
                content: '<p>David, hijo de Isaí de Belén, es una de las figuras más prominentes del Antiguo Testamento...</p>',
                tags: [
                    { id: 3, name: 'David' }
                ],
                fileType: 'text',
                fileName: null,
                fileUrl: null,
                createdAt: '2025-05-10T14:45:00'
            },
            {
                id: 3,
                title: 'La gracia en el Nuevo Testamento',
                description: 'Exploración del concepto teológico de la gracia divina',
                content: '<p>La gracia (del griego "charis") es uno de los conceptos teológicos fundamentales del Nuevo Testamento...</p>',
                tags: [
                    { id: 5, name: 'Gracia' },
                    { id: 6, name: 'Fe' }
                ],
                fileType: 'text',
                fileName: null,
                fileUrl: null,
                createdAt: '2025-05-05T09:15:00'
            }
        ];
        
        // Cargar categorías de ejemplo
        const categoryFilters = document.getElementById('category-filters');
        categoryFilters.innerHTML = '';
        
        sampleCategories.forEach(category => {
            const filterOption = document.createElement('div');
            filterOption.className = 'filter-option';
            filterOption.innerHTML = `
                <input type="checkbox" id="category-${category.id}" value="${category.id}">
                <label for="category-${category.id}">${category.name}</label>
            `;
            categoryFilters.appendChild(filterOption);
        });
        
        // Cargar etiquetas de ejemplo
        const tagFilters = document.getElementById('tag-filters');
        tagFilters.innerHTML = '';
        
        sampleTags.forEach(tag => {
            const filterOption = document.createElement('div');
            filterOption.className = 'filter-option';
            filterOption.innerHTML = `
                <input type="checkbox" id="tag-${tag.id}" value="${tag.id}">
                <label for="tag-${tag.id}">${tag.name}</label>
            `;
            tagFilters.appendChild(filterOption);
        });
        
        // Agregar eventos a los filtros
        document.querySelectorAll('#category-filters input, #tag-filters input, #file-type-filters input').forEach(input => {
            input.addEventListener('change', applyFilters);
        });
        
        // Guardar datos para uso local
        allDocuments = sampleDocuments;
        totalDocuments = sampleDocuments.length;
        
        // Renderizar documentos
        renderDocuments(sampleDocuments);
        
        // Generar paginación
        generatePagination(totalDocuments, documentsPerPage, currentPage);
    }
    
    // Renderizar documentos en la página
    function renderDocuments(docs = []) {
        const resultsContainer = document.getElementById('results');
        resultsContainer.innerHTML = '';
        
        if (docs.length === 0) {
            resultsContainer.innerHTML = '<div class="no-results"><h3>No se encontraron resultados</h3><p>Intenta cambiar tus filtros o términos de búsqueda.</p></div>';
            return;
        }
        
        docs.forEach(doc => {
            const docElement = document.createElement('div');
            docElement.className = 'document-card';
            
            let tagsHtml = '';
            if (doc.tags && doc.tags.length > 0) {
                doc.tags.forEach(tag => {
                    tagsHtml += `<span class="document-tag">${tag.name}</span>`;
                });
            }
            
            docElement.innerHTML = `
                <div class="document-card-content">
                    <h3 class="document-title">${doc.title}</h3>
                    <p class="document-description">${doc.description}</p>
                    <div class="document-tags">
                        ${tagsHtml}
                    </div>
                    <button class="document-view-btn" data-id="${doc.id}">Ver documento</button>
                </div>
            `;
            
            resultsContainer.appendChild(docElement);
        });
        
        // Agregar eventos a los botones de ver documento
        document.querySelectorAll('.document-view-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const docId = parseInt(this.getAttribute('data-id'));
                openDocument(docId);
            });
        });
    }
    
    // Abrir documento en nueva pestaña
    function openDocument(docId) {
        window.open(`ver-documento.html?id=${docId}`, '_blank');
    }
    
    // Búsqueda de documentos
    document.getElementById('search-btn').addEventListener('click', async function() {
        const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
        
        if (!searchTerm) {
            // Si no hay término de búsqueda, mostrar todos los documentos
            currentPage = 1;
            await loadDocuments();
            return;
        }
        
        try {
            // Intentar búsqueda en Supabase (si estamos conectados)
            const { data, error } = await supabase
                .from('documents')
                .select(`
                    *,
                    tags (*)
                `)
                .or(`title.ilike.%${searchTerm}%,description.ilike.%${searchTerm}%,content.ilike.%${searchTerm}%`)
                .order('created_at', { ascending: false });
                
            if (error) throw error;
            
            allDocuments = data || [];
            totalDocuments = allDocuments.length;
            renderDocuments(allDocuments.slice(0, documentsPerPage));
            generatePagination(totalDocuments, documentsPerPage, 1);
            currentPage = 1;
            
        } catch (error) {
            console.error('Error en la búsqueda:', error);
            
            // Búsqueda local si hay error con Supabase
            const filteredDocs = allDocuments.filter(doc => {
                return doc.title.toLowerCase().includes(searchTerm) ||
                       doc.description.toLowerCase().includes(searchTerm) ||
                       doc.content.toLowerCase().includes(searchTerm);
            });
            
            totalDocuments = filteredDocs.length;
            renderDocuments(filteredDocs.slice(0, documentsPerPage));
            generatePagination(totalDocuments, documentsPerPage, 1);
            currentPage = 1;
        }
    });
    
    // También permitir búsqueda al presionar Enter
    document.getElementById('search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            document.getElementById('search-btn').click();
        }
    });
    
    // Aplicar filtros seleccionados
    async function applyFilters() {
        // Obtener filtros seleccionados
        const selectedTags = [];
        document.querySelectorAll('#tag-filters input:checked').forEach(input => {
            selectedTags.push(parseInt(input.value));
        });
        
        const selectedFileTypes = [];
        document.querySelectorAll('#file-type-filters input:checked').forEach(input => {
            selectedFileTypes.push(input.value);
        });
        
        // Si no hay filtros seleccionados, mostrar todos los documentos
        if (selectedTags.length === 0 && selectedFileTypes.length === 0) {
            currentPage = 1;
            await loadDocuments();
            return;
        }
        
        try {
            // Aplicar filtros en Supabase
            let query = supabase
                .from('documents')
                .select(`
                    *,
                    tags (*)
                `);
            
            // Filtrar por etiquetas si hay seleccionadas
            if (selectedTags.length > 0) {
                // Este es un ejemplo simplificado - en un sistema real necesitarías
                // una tabla de relación documentos-etiquetas y una consulta más compleja
                query = query.contains('tags', selectedTags);
            }
            
            // Obtener resultados
            const { data, error } = await query.order('created_at', { ascending: false });
            
            if (error) throw error;
            
            let filteredDocs = data || [];
            
            // Filtrar por tipo de archivo (si hay seleccionados)
            if (selectedFileTypes.length > 0) {
                filteredDocs = filteredDocs.filter(doc => {
                    return selectedFileTypes.includes(doc.file_type || 'text');
                });
            }
            
            allDocuments = filteredDocs;
            totalDocuments = filteredDocs.length;
            renderDocuments(filteredDocs.slice(0, documentsPerPage));
            generatePagination(totalDocuments, documentsPerPage, 1);
            currentPage = 1;
            
        } catch (error) {
            console.error('Error al aplicar filtros:', error);
            
            // Filtrado local si hay error con Supabase
            let filteredDocs = [...allDocuments];
            
            // Filtrar por etiquetas
            if (selectedTags.length > 0) {
                filteredDocs = filteredDocs.filter(doc => {
                    return doc.tags && doc.tags.some(tag => selectedTags.includes(tag.id));
                });
            }
            
            // Filtrar por tipo de archivo
            if (selectedFileTypes.length > 0) {
                filteredDocs = filteredDocs.filter(doc => {
                    return selectedFileTypes.includes(doc.fileType || 'text');
                });
            }
            
            totalDocuments = filteredDocs.length;
            renderDocuments(filteredDocs.slice(0, documentsPerPage));
            generatePagination(totalDocuments, documentsPerPage, 1);
            currentPage = 1;
        }
    }
    
    // Generar paginación
    function generatePagination(totalDocs, docsPerPage = 9, currentPage = 1) {
        const totalPages = Math.ceil(totalDocs / docsPerPage);
        
        // Si solo hay una página, no mostrar paginación
        if (totalPages <= 1) {
            document.getElementById('pagination').style.display = 'none';
            return;
        }
        
        document.getElementById('pagination').style.display = 'flex';
        const pagination = document.getElementById('pagination');
        pagination.innerHTML = '';
        
        // Botón anterior
        const prevBtn = document.createElement('button');
        prevBtn.className = 'pagination-btn';
        prevBtn.innerHTML = '&laquo; Anterior';
        prevBtn.disabled = currentPage === 1;
        prevBtn.addEventListener('click', function() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        });
        pagination.appendChild(prevBtn);
        
        // Botones de páginas
        const maxButtons = 5; // Máximo número de botones a mostrar
        let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);
        
        // Ajustar si estamos cerca del final
        if (endPage - startPage + 1 < maxButtons && startPage > 1) {
            startPage = Math.max(1, endPage - maxButtons + 1);
        }
        
        for (let i = startPage; i <= endPage; i++) {
            const pageBtn = document.createElement('button');
            pageBtn.className = 'pagination-btn' + (i === currentPage ? ' active' : '');
            pageBtn.textContent = i;
            pageBtn.addEventListener('click', function() {
                goToPage(i);
            });
            pagination.appendChild(pageBtn);
        }
        
        // Botón siguiente
        const nextBtn = document.createElement('button');
        nextBtn.className = 'pagination-btn';
        nextBtn.innerHTML = 'Siguiente &raquo;';
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.addEventListener('click', function() {
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        });
        pagination.appendChild(nextBtn);
    }
    
    // Ir a una página específica
    async function goToPage(page) {
        currentPage = page;
        
        try {
            // Obtener documentos para la página específica
            const { data: documents, error } = await supabase
                .from('documents')
                .select(`
                    *,
                    tags (*)
                `)
                .order('created_at', { ascending: false })
                .range((page - 1) * documentsPerPage, page * documentsPerPage - 1);
                
            if (error) throw error;
            
            renderDocuments(documents || []);
            generatePagination(totalDocuments, documentsPerPage, page);
            
            // Hacer scroll hacia arriba
            window.scrollTo(0, document.querySelector('.page-content').offsetTop - 100);
            
        } catch (error) {
            console.error('Error al cargar página:', error);
            
            // Paginación local si hay error con Supabase
            const startIndex = (page - 1) * documentsPerPage;
            const endIndex = startIndex + documentsPerPage;
            const pageDocuments = allDocuments.slice(startIndex, endIndex);
            
            renderDocuments(pageDocuments);
            generatePagination(allDocuments.length, documentsPerPage, page);
            
            // Hacer scroll hacia arriba
            window.scrollTo(0, document.querySelector('.page-content').offsetTop - 100);
        }
    }
</script>

</body>
</html>

        